id: 5
source: 1
name: scripts
description: ''
properties: 'a:0:{}'

-----

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Menu script loaded');
    
    // Базовые элементы
    const mobileBtn = document.querySelector('.mobile-menu-btn');
    const navMenu = document.querySelector('.nav-menu');
    const overlay = document.querySelector('.mobile-overlay');
    const dropdownItems = document.querySelectorAll('.has-dropdown');
    
    // Глобальные переменные для управления меню
    let isMobileMenuOpen = false;
    let scrollPosition = 0;
    
    // ========== 1. МОБИЛЬНОЕ МЕНЮ ==========
    if (mobileBtn && navMenu && overlay) {
        console.log('Mobile menu elements found');
        
        // Функция открытия мобильного меню
        function openMobileMenu() {
            if (isMobileMenuOpen) return;
            
            // Сохраняем позицию скролла
            scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
            
            // Открываем меню
            navMenu.classList.add('active');
            overlay.classList.add('active');
            mobileBtn.setAttribute('aria-expanded', 'true');
            mobileBtn.setAttribute('aria-label', 'Закрыть навигацию');
            
            // Блокировка скролла
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.body.style.width = '100%';
            document.body.style.top = `-${scrollPosition}px`;
            
            // Анимация кнопки гамбургера
            const spans = mobileBtn.querySelectorAll('span');
            spans[0].style.transform = 'rotate(45deg) translate(7px, 7px)';
            spans[1].style.opacity = '0';
            spans[2].style.transform = 'rotate(-45deg) translate(7px, -7px)';
            
            // Закрыть все открытые выпадающие меню
            dropdownItems.forEach(item => {
                item.classList.remove('active');
                const dropdown = item.querySelector('.dropdown');
                if (dropdown) {
                    dropdown.classList.remove('active');
                    dropdown.style.maxHeight = null;
                }
            });
            
            isMobileMenuOpen = true;
        }
        
        // Функция закрытия мобильного меню
        function closeMobileMenu() {
            if (!isMobileMenuOpen) return;
            
            // Закрываем меню
            navMenu.classList.remove('active');
            overlay.classList.remove('active');
            mobileBtn.setAttribute('aria-expanded', 'false');
            mobileBtn.setAttribute('aria-label', 'Открыть навигацию');
            
            // Разблокировка скролла
            document.body.style.overflow = '';
            document.body.style.position = '';
            document.body.style.width = '';
            document.body.style.top = '';
            
            // Восстанавливаем позицию скролла
            window.scrollTo(0, scrollPosition);
            
            // Анимация кнопки гамбургера обратно
            const spans = mobileBtn.querySelectorAll('span');
            spans[0].style.transform = '';
            spans[1].style.opacity = '';
            spans[2].style.transform = '';
            
            // Закрыть все выпадающие меню
            dropdownItems.forEach(item => {
                item.classList.remove('active');
                const dropdown = item.querySelector('.dropdown');
                if (dropdown) {
                    dropdown.classList.remove('active');
                    dropdown.style.maxHeight = null;
                }
            });
            
            isMobileMenuOpen = false;
            scrollPosition = 0;
        }
        
        // Функция переключения меню
        function toggleMobileMenu() {
            if (isMobileMenuOpen) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        }
        
        // Обработчики событий для мобильного меню
        mobileBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleMobileMenu();
        });
        
        overlay.addEventListener('click', function(e) {
            e.stopPropagation();
            closeMobileMenu();
        });
        
        // Закрытие по клавише Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && isMobileMenuOpen) {
                closeMobileMenu();
            }
        });
        
        // Закрытие меню при клике на ссылку
        document.addEventListener('click', function(e) {
            if (!isMobileMenuOpen) return;
            
            const target = e.target;
            const isLink = target.classList.contains('nav-link') || 
                          target.classList.contains('dropdown-item');
            
            // Если кликнули по ссылке и меню открыто
            if (isLink && isMobileMenuOpen) {
                // Для выпадающих меню - своя логика
                if (target.classList.contains('nav-link') && target.closest('.has-dropdown')) {
                    return; // Обрабатывается отдельно
                }
                
                // Для обычных ссылок закрываем меню
                closeMobileMenu();
            }
        });
    }
    
    // ========== 2. ВЫПАДАЮЩИЕ МЕНЮ НА МОБИЛЬНЫХ ==========
    dropdownItems.forEach(item => {
        const link = item.querySelector('.nav-link');
        
        if (link) {
            link.addEventListener('click', function(e) {
                // Только для мобильных устройств
                if (window.innerWidth <= 850) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const isActive = item.classList.contains('active');
                    
                    // Закрыть все другие выпадающие меню
                    dropdownItems.forEach(otherItem => {
                        if (otherItem !== item && otherItem.classList.contains('active')) {
                            otherItem.classList.remove('active');
                            const dropdown = otherItem.querySelector('.dropdown');
                            if (dropdown) {
                                dropdown.classList.remove('active');
                                dropdown.style.maxHeight = null;
                            }
                        }
                    });
                    
                    // Переключить текущее выпадающее меню
                    if (!isActive) {
                        item.classList.add('active');
                        const dropdown = item.querySelector('.dropdown');
                        if (dropdown) {
                            dropdown.classList.add('active');
                            dropdown.style.maxHeight = dropdown.scrollHeight + 'px';
                        }
                        link.setAttribute('aria-expanded', 'true');
                    } else {
                        item.classList.remove('active');
                        const dropdown = item.querySelector('.dropdown');
                        if (dropdown) {
                            dropdown.classList.remove('active');
                            dropdown.style.maxHeight = null;
                        }
                        link.setAttribute('aria-expanded', 'false');
                    }
                }
                // На десктопе разрешаем стандартный переход по ссылке
            });
        }
    });
    
    // ========== 3. ВЫПАДАЮЩИЕ МЕНЮ НА ДЕСКТОПЕ (ХОВЕР) ==========
    function setupDesktopDropdowns() {
        dropdownItems.forEach(item => {
            const link = item.querySelector('.nav-link');
            const dropdown = item.querySelector('.dropdown');
            
            if (dropdown) {
                // Показать меню при наведении
                item.addEventListener('mouseenter', function() {
                    if (window.innerWidth > 850) {
                        item.classList.add('hover-active');
                        dropdown.style.opacity = '1';
                        dropdown.style.visibility = 'visible';
                        dropdown.style.transform = 'translate(-50%, 8px)';
                    }
                });
                
                // Скрыть меню при уходе курсора
                item.addEventListener('mouseleave', function(e) {
                    if (window.innerWidth > 850) {
                        // Проверяем, не перешел ли курсор в выпадающее меню
                        const related = e.relatedTarget;
                        if (!related || !dropdown.contains(related)) {
                            item.classList.remove('hover-active');
                            dropdown.style.opacity = '0';
                            dropdown.style.visibility = 'hidden';
                            dropdown.style.transform = 'translate(-50%, 15px)';
                        }
                    }
                });
                
                // Убедиться, что меню скрыто при уходе курсора из выпадающего списка
                dropdown.addEventListener('mouseleave', function(e) {
                    if (window.innerWidth > 850) {
                        const related = e.relatedTarget;
                        if (!related || !item.contains(related)) {
                            item.classList.remove('hover-active');
                            dropdown.style.opacity = '0';
                            dropdown.style.visibility = 'hidden';
                            dropdown.style.transform = 'translate(-50%, 15px)';
                        }
                    }
                });
            }
        });
    }
    
    // ========== 4. АКТИВНЫЙ ПУНКТ МЕНЮ ==========
    function setActiveMenuItem() {
        const currentPath = window.location.pathname;
        const currentUrl = window.location.href;
        
        // Удалить активные классы со всех элементов
        document.querySelectorAll('.nav-link, .dropdown-item').forEach(link => {
            link.classList.remove('active');
            link.removeAttribute('aria-current');
        });
        
        // Найти текущую страницу в меню
        document.querySelectorAll('.nav-link, .dropdown-item').forEach(link => {
            const href = link.getAttribute('href');
            
            if (href) {
                // Простая проверка - если текущий URL содержит путь из ссылки
                if (currentUrl.includes(href) || currentPath === href) {
                    link.classList.add('active');
                    link.setAttribute('aria-current', 'page');
                    
                    // Если это элемент выпадающего меню, отметить родителя
                    const parentDropdown = link.closest('.has-dropdown');
                    if (parentDropdown) {
                        parentDropdown.classList.add('active');
                        const parentLink = parentDropdown.querySelector('.nav-link');
                        if (parentLink) {
                            parentLink.classList.add('active');
                            parentLink.setAttribute('aria-expanded', 'true');
                        }
                    }
                }
            }
        });
    }
    
    // ========== 5. ОБРАБОТКА ИЗМЕНЕНИЯ РАЗМЕРА ОКНА ==========
    let resizeTimer;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
            // При переходе на десктопный размер
            if (window.innerWidth > 850) {
                // Закрыть мобильное меню если открыто
                if (isMobileMenuOpen) {
                    closeMobileMenu();
                }
                
                // Сбросить все активные классы выпадающих меню
                dropdownItems.forEach(item => {
                    item.classList.remove('active', 'hover-active');
                    const dropdown = item.querySelector('.dropdown');
                    if (dropdown) {
                        dropdown.classList.remove('active');
                        dropdown.style.maxHeight = null;
                        dropdown.style.opacity = '';
                        dropdown.style.visibility = '';
                        dropdown.style.transform = '';
                    }
                });
                
                // Перенастроить десктопные выпадающие меню
                setupDesktopDropdowns();
            }
        }, 250);
    });
    
    // ========== 6. ПЛАВНАЯ ПРОКРУТКА ХЕДЕРА ==========
    let lastScrollTop = 0;
    const header = document.querySelector('.header');
    
    if (header) {
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > 50) {
                header.style.minHeight = '80px';
                document.querySelector('.header-container').style.height = '80px';
            } else {
                header.style.minHeight = '90px';
                document.querySelector('.header-container').style.height = '90px';
            }
            
            if (scrollTop > lastScrollTop && scrollTop > 100) {
                header.style.transform = 'translateY(-100%)';
            } else {
                header.style.transform = 'translateY(0)';
            }
            
            lastScrollTop = scrollTop;
        });
    }
    
    // ========== 7. ЛОГОТИП - ОБРАБОТКА ОШИБКИ ==========
    const logoImg = document.querySelector('.logo-img');
    if (logoImg) {
        logoImg.addEventListener('error', function() {
            console.warn('Logo image failed to load');
            this.style.display = 'none';
            const fallback = document.createElement('div');
            fallback.textContent = 'Farpost Technologies';
            fallback.style.fontFamily = "'Montserrat', sans-serif";
            fallback.style.fontWeight = '500';
            fallback.style.fontSize = '20px';
            fallback.style.color = '#000';
            this.parentElement.appendChild(fallback);
        });
    }
    
    // ========== 8. ИНИЦИАЛИЗАЦИЯ ==========
    // Вызвать функции инициализации
    setupDesktopDropdowns();
    setActiveMenuItem();
    
    console.log('Menu initialized successfully');
    console.log('Screen width:', window.innerWidth, 'px');
    console.log('Dropdown items:', dropdownItems.length);
});
</script>